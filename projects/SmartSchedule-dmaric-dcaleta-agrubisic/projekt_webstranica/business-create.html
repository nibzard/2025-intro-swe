<<<<<<< HEAD
<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <title>SmartSchedule – Izrada poslovnog rasporeda</title>
    <link rel="stylesheet" href="global.css">
</head>

<body>

<!-- TOP NAVIGATION -->
<div class="topnav" style="position:relative;">

    <!-- LOGO LEFT -->
    <div class="logo-box">
        <div class="logo-icon">SS</div>
        <div class="logo-text">SmartSchedule</div>
    </div>

    <!-- CENTERED NAVIGATION -->
    <div class="nav-links" style="
        position:absolute;
        left:50%;
        transform:translateX(-50%);
    ">
        <a href="index.html" data-link="index">Početna</a>
        <a href="dashboard.html" data-link="dashboard">Dashboard</a>

    </div>
</div>

<!-- FIXED NAVIGATION SCRIPT -->
<script>
// mapiranje datoteka → logički koraci
const pageMap = {
    "index": "index",
    "dashboard": "dashboard",
    "personal": "personal",
    "business-create": "create",
    "business-final": "final"
};

// ime trenutne html datoteke
let rawName = document.location.pathname.split("/").pop().replace(".html", "");
if (rawName === "") rawName = "index";

// logički naziv stranice
const currentPage = pageMap[rawName] || "index";

// redoslijed stranica
const steps = ["index", "dashboard", "personal", "create", "final"];
const currentIndex = steps.indexOf(currentPage);

// primjena zaključavanja
document.querySelectorAll(".nav-links a").forEach(a => {
    const page = a.getAttribute("data-link");
    const pageIndex = steps.indexOf(page);

    if (pageIndex !== -1 && pageIndex <= currentIndex) {
        a.style.pointerEvents = "auto";
        a.style.opacity = "1";
    } else {
        a.style.pointerEvents = "none";
        a.style.opacity = "0.35";
    }
});
</script>


<!-- PAGE TITLE BAR -->
<div class="topbar" style="
    padding:18px 28px;
    background:var(--bg-alt);
    border-bottom:1px solid var(--border);
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:30px;
">
    <h2 style="margin:0;">Izrada poslovnog rasporeda</h2>
    <span style="color:var(--text-soft); font-size:15px;">Tjedan 6.1 – 12.1</span>
</div>


<div class="container">

    <!-- PODACI TVRTKE -->
    <div class="card">
        <h3>Podaci tvrtke</h3>
        <p style="margin-top:8px; color:var(--text-soft);">
            Ovo su podaci uneseni pri registraciji poslodavca.
        </p>

        <div style="margin-top:15px; line-height:1.8;">
            <p>Naziv: <b>Vaša Firma</b></p>
            <p>OIB: <b>12345678901</b></p>
            <p>Adresa: <b>Industrijska 12, Split</b></p>
        </div>
    </div>

    <!-- RADNICI -->
    <h2 style="margin-top:35px;">Radnici</h2>
    <p style="color:var(--text-soft); margin-bottom:15px;">
        Dodajte sve radnike i njihove bilješke. AI će pokušati zadovoljiti sve uvjete.
    </p>

    <div id="workersPanel">

        <!-- DEFAULT WORKER BOX -->
        <div class="worker-box">
            <input type="text" placeholder="Ime radnika">
            <textarea placeholder="Zahtjevi / bilješke (npr. utorak popodne slobodno)" 
                      style="height:80px;"></textarea>
        </div>

    </div>

    <!-- ADD WORKER -->
    <button class="btn" style="margin-top:10px;" onclick="addWorker()">+ Dodaj radnika</button>

    <!-- SUBMIT -->
    <button class="btn" style="margin-top:30px;" onclick="location.href='business-final.html'">
        Pošalji
    </button>

</div>

<script>
function addWorker() {
    const panel = document.getElementById("workersPanel");

    const worker = document.createElement("div");
    worker.className = "worker-box";

    worker.innerHTML = `
        <input type="text" placeholder="Ime radnika">
        <textarea placeholder="Zahtjevi / bilješke (npr. utorak popodne slobodno)" 
                  style="height:80px;"></textarea>
    `;

    panel.appendChild(worker);
}
</script>

</body>
</html>
=======
<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <title>SmartSchedule – Izrada poslovnog rasporeda</title>
    <link rel="stylesheet" href="global.css">
</head>

<body>

<!-- TOP NAVIGATION -->
<div class="topnav" style="position:relative;">

    <!-- LOGO LEFT -->
    <div class="logo-box">
        <div class="logo-icon">SS</div>
        <div class="logo-text">SmartSchedule</div>
    </div>

    <!-- CENTERED NAVIGATION -->
    <div class="nav-links" style="
        position:absolute;
        left:50%;
        transform:translateX(-50%);
    ">
        <a href="index.html" data-link="index">Početna</a>
        <a href="dashboard.html" data-link="dashboard">Dashboard</a>

    </div>

    <!-- USER AREA -->
    <div id="userArea" style="position:absolute; right:12px; top:12px;"></div>
</div>

<!-- FIXED NAVIGATION SCRIPT -->
<script>
// mapiranje datoteka → logički koraci
const pageMap = {
    "index": "index",
    "dashboard": "dashboard",
    "personal": "personal",
    "business-create": "create",
    "business-final": "final"
};

// ime trenutne html datoteke
let rawName = document.location.pathname.split("/").pop().replace(".html", "");
if (rawName === "") rawName = "index";

// logički naziv stranice
const currentPage = pageMap[rawName] || "index";

// redoslijed stranica
const steps = ["index", "dashboard", "personal", "create", "final"];
const currentIndex = steps.indexOf(currentPage);

// primjena zaključavanja
document.querySelectorAll(".nav-links a").forEach(a => {
    const page = a.getAttribute("data-link");
    const pageIndex = steps.indexOf(page);

    if (pageIndex !== -1 && pageIndex <= currentIndex) {
        a.style.pointerEvents = "auto";
        a.style.opacity = "1";
    } else {
        a.style.pointerEvents = "none";
        a.style.opacity = "0.35";
    }
});
</script>


<!-- PAGE TITLE BAR -->
<div class="topbar" style="
    padding:18px 28px;
    background:var(--bg-alt);
    border-bottom:1px solid var(--border);
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:30px;
">
    <h2 style="margin:0;">Izrada poslovnog rasporeda</h2>
    <span style="color:var(--text-soft); font-size:15px;">Tjedan 6.1 – 12.1</span>
</div>


<div class="container">

    <!-- PODACI TVRTKE -->
    <div class="card">
        <h3>Podaci tvrtke</h3>
        <p style="margin-top:8px; color:var(--text-soft);">
            Ovo su podaci uneseni pri registraciji poslodavca.
        </p>
        <div id="companyInfo" style="margin-top:15px; line-height:1.8;">
            <p>Naziv: <b id="ci_name">-</b></p>
            <p>OIB: <b id="ci_oib">-</b></p>
            <p>Adresa: <b id="ci_addr">-</b></p>
        </div>
    </div>

    <!-- RADNICI -->
    <h2 style="margin-top:35px;">Radnici</h2>
    <p style="color:var(--text-soft); margin-bottom:15px;">
        Dodajte sve radnike i njihove bilješke. AI će pokušati zadovoljiti sve uvjete.
    </p>

    <div id="workersPanel">
        <!-- DEFAULT WORKER BOX -->
        <div class="worker-box">
            <input type="text" placeholder="Ime radnika">
            <textarea placeholder="Zahtjevi / bilješke (npr. utorak popodne slobodno)" style="height:80px;"></textarea>
        </div>
    </div>

    <!-- ADD WORKER -->
    <button id="addWorkerBtn" class="btn" style="margin-top:10px;">+ Dodaj radnika</button>

    <!-- SUBMIT -->
    <div style="margin-top:18px; display:flex; gap:12px; align-items:center;">
        <button id="submitScheduleBtn" class="btn">Pošalji</button>
        <div id="createdCode" style="color:var(--accent); font-weight:600;"></div>
    </div>

    <!-- Schedule-level company settings (local to this schedule) -->
    <div class="card" style="margin-top:18px;">
        <h3>Postavke za ovaj raspored</h3>
        <p style="color:var(--text-soft); margin-top:6px;">Postavke se primjenjuju samo na ovaj raspored i mogu se razlikovati od zadanih postavki tvrtke.</p>
        <div style="margin-top:10px;">
            <label for="local_worktime">Radno vrijeme (npr. 07:00-21:00):</label>
            <input id="local_worktime" type="text" pattern="^\d{2}:\d{2}-\d{2}:\d{2}$" placeholder="07:00-21:00" style="padding:6px; border-radius:4px;">
            <label>Tjedni limit (sati):</label>
            <input id="local_weeklyLimit" type="number" min="0">
        </div>
    </div>

    <div id="companySettingsHint" style="color:#c33; margin-top:8px; min-height:18px;"></div>

</div>

<script>
function addWorker() {
    const panel = document.getElementById("workersPanel");

    const worker = document.createElement("div");
    worker.className = "worker-box";

    worker.innerHTML = `
        <input type="text" placeholder="Ime radnika">
        <textarea placeholder="Zahtjevi / bilješke (npr. utorak popodne slobodno)" 
                  style="height:80px;"></textarea>
    `;

    panel.appendChild(worker);

// wire UI
        // wire UI
        document.getElementById('addWorkerBtn').addEventListener('click', addWorker);
// include auth and schedules
</script>

<script src="auth.js"></script>
<script src="schedules.js"></script>
<script>
const user = ssAuth.requireAuth();
// show company info if available
if (user.isBoss && user.company) {
    document.getElementById('ci_name').innerText = user.company.name || '-';
    document.getElementById('ci_oib').innerText = user.company.oib || '-';
    document.getElementById('ci_addr').innerText = user.company.address || '-';
} else {
    const info = document.getElementById('companyInfo');
    if (info) info.innerHTML = '<em>Nema podataka o tvrtki (niste registrirani kao poslodavac).</em>';
}
// user area
const ua = document.getElementById('userArea');
if (ua) ua.innerHTML = `<span style="color:var(--text-soft); margin-right:10px;">${user.name}</span> <button class="btn-gray" onclick="ssAuth.logout(); location.href='index.html';">Odjava</button>`;

// initialize schedule-level settings editor (pre-fill from company defaults if available)
(function(){
    const submitBtn = document.getElementById('submitScheduleBtn');
    const hint = document.getElementById('companySettingsHint');
    if (!user.isBoss) {
        submitBtn.disabled = true;
        if (hint) hint.innerText = 'Samo poslodavci mogu kreirati poslovne rasporede.';
        return;
    }

    const defaults = (window.ssAuth && ssAuth.getCompanySettings) ? ssAuth.getCompanySettings(user.id) : null;
    // fill defaults
    if (defaults) {
        document.getElementById('local_worktime').value = defaults.workTime || '';
        document.getElementById('local_weeklyLimit').value = defaults.weeklyLimit || '';
    }

    // submit handler collects local settings and passes to createSchedule
    document.getElementById('submitScheduleBtn').addEventListener('click', ()=>{
        const workers = ssSchedules.collectWorkersFromDOM('workersPanel');
        if (!workers.length) return alert('Dodaj barem jednog radnika');

        // collect settings from form
        const workTime = document.getElementById('local_worktime').value;
        const weekly = parseFloat(document.getElementById('local_weeklyLimit').value) || 0;
        const settings = { workTime, weeklyLimit: weekly };

        try {
            const schedule = ssSchedules.createSchedule({ownerId: user.id, workers, companySettings: settings});
            document.getElementById('createdCode').innerText = `Šifra rasporeda: ${schedule.code}`;
            sessionStorage.setItem('ss_current_schedule', schedule.code);
            setTimeout(()=> location.href = `business-final.html?code=${schedule.code}`, 700);
        } catch (e) {
            alert('Greška pri kreiranju rasporeda: ' + e.message);
        }
    });

})();

</script>

</body>

</html>
>>>>>>> 04342a810ea5441727877f814c8d4fc9141799b1
