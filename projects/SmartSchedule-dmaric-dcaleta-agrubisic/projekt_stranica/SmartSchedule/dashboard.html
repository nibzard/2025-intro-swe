<!-- dashboard.html - Odabir osobni/poslovni raspored -->
<!DOCTYPE html>
<html lang="hr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SmartSchedule - Naslovna</title>
  <link rel="stylesheet" href="css/global.css">
</head>
<body>
  <div id="profileCorner" style="position:absolute;top:18px;right:24px;background:#20243a;padding:8px 16px;border-radius:8px;color:#3a7afe;font-weight:bold;font-size:1.1em;z-index:10;display:flex;align-items:center;gap:16px;"></div>
  <div class="container dashboard-container">
    <h2>Dobrodošli!</h2>
    <div id="dashboardOptions"></div>
    <button id="logoutBtn">Odjava</button>
  </div>
  <script src="js/auth.js"></script>
  <script src="js/navigation.js"></script>
  <script>
  // Prikaz profila u kutu
  document.addEventListener('DOMContentLoaded', function() {
    const session = sessionStorage.getItem('sessionUser');
    if (session) {
      const user = JSON.parse(session);
      const profileDiv = document.getElementById('profileCorner');
      if (profileDiv) {
        profileDiv.innerHTML = `${user.username}#${user.id || ''} <button id='cornerLogoutBtn' style='margin-left:12px;background:#3a7afe;color:#fff;border:none;padding:4px 12px;border-radius:6px;cursor:pointer;'>Odjava</button>`;
        document.getElementById('cornerLogoutBtn').onclick = function() { sessionStorage.removeItem('sessionUser'); window.location.href = 'index.html'; };
      }
    }
    // ...existing dashboard logic...
    if (!session) return;
    const user = JSON.parse(session);
    const optionsDiv = document.getElementById('dashboardOptions');
    if (!optionsDiv) return;
    let html = '';
    if (user.role === 'boss') {
      html += '<a href="business-create.html"><button>Kreiraj/uredi poslovni raspored</button></a>';
      html += '<a href="business-final.html"><button>Pregled i AI upravljanje</button></a>';
      html += '<button id="openCompanyModal">Uredi podatke tvrtke</button>';
      // Prikaz svih spremljenih rasporeda
      let allSchedules = JSON.parse(localStorage.getItem('allSchedules') || '{}');
      let scheduleList = Object.entries(allSchedules).map(([code, info]) => {
        let name = info.name || '(bez naziva)';
        return `<li style="margin-bottom:8px;padding:8px 12px;background:#181c24;border-radius:8px;">Naziv: <b>${name}</b><br>Kod: <span style="color:#3a7afe;font-weight:bold;">${code}</span><br><button class='openScheduleBtn' data-code='${code}' style='margin-top:6px;'>Otvori/uredi</button> <button class='deleteScheduleBtn' data-code='${code}' style='margin-top:6px;background:#e74c3c;color:#fff;border:none;padding:4px 10px;border-radius:6px;cursor:pointer;'>Obriši</button></li>`;
      }).join('');
      if (scheduleList) {
        html += '<div style="margin:18px 0 0 0;padding:12px;background:#20243a;border-radius:8px;"><b>Svi spremljeni rasporedi:</b><ul style="list-style:none;padding:0;margin:0;">' + scheduleList + '</ul></div>';
      }
        // Dodaj event listenere za otvaranje rasporeda
        setTimeout(() => {
          document.querySelectorAll('.openScheduleBtn').forEach(btn => {
            btn.onclick = function() {
              const code = btn.getAttribute('data-code');
              localStorage.setItem('scheduleCode', code);
              window.location.href = 'business-final.html';
            };
          });
          document.querySelectorAll('.deleteScheduleBtn').forEach(btn => {
            btn.onclick = function() {
              const code = btn.getAttribute('data-code');
              if (confirm('Želite li zaista obrisati ovaj raspored?')) {
                let allSchedules = JSON.parse(localStorage.getItem('allSchedules') || '{}');
                delete allSchedules[code];
                localStorage.setItem('allSchedules', JSON.stringify(allSchedules));
                // Osvježi prikaz
                btn.parentElement.remove();
              }
            };
          });
        }, 100);
    } else {
      html += '<a href="personal.html"><button>Pristupi rasporedu</button></a>';
      html += '<button id="openRequestModal">Daj zahtjev za radne dane</button>';
    }
    optionsDiv.innerHTML = html;

    // Modal za podatke tvrtke (dodaje se izvan HTML-a)
    if (user.role === 'boss') {
      let companyModal = document.createElement('div');
      companyModal.id = 'companyModal';
      companyModal.style.display = 'none';
      companyModal.style.position = 'fixed';
      companyModal.style.top = '0';
      companyModal.style.left = '0';
      companyModal.style.width = '100vw';
      companyModal.style.height = '100vh';
      companyModal.style.background = 'rgba(0,0,0,0.7)';
      companyModal.style.justifyContent = 'center';
      companyModal.style.alignItems = 'center';
      companyModal.innerHTML = '<div style="background:#181c24;padding:36px 28px;border-radius:16px;max-width:440px;margin:100px auto;display:flex;flex-direction:column;gap:18px;box-shadow:0 6px 32px #000b;border:2px solid #232837;">'
        + '<h3>Podaci tvrtke</h3>'
        + '<form id="companyForm">'
        + '<input type="text" id="modalCompanyName" placeholder="Naziv tvrtke" required autocomplete="off">'
        + '<label>Radni dani:</label>'
        + '<select id="modalWorkDays"><option value="6">Ponedjeljak - Subota</option><option value="7">Ponedjeljak - Nedjelja</option></select>'
        + '<label>Radno vrijeme:</label>'
        + '<input type="text" id="modalWorkHours" placeholder="07:00-21:00" required autocomplete="off">'
        + '<label>Tjedni limit sati po radniku:</label>'
        + '<input type="number" id="modalWeeklyLimit" value="40" min="1" max="60" required autocomplete="off">'
        + '<button type="submit">Spremi podatke</button>'
        + '<button type="button" id="closeCompanyModal" style="background:#444;margin-top:8px;">Odustani</button>'
        + '</form></div>';
      document.body.appendChild(companyModal);
      document.getElementById('openCompanyModal').onclick = function() {
        // Popuni modal s postojećim podacima
        const companyData = JSON.parse(localStorage.getItem('companyData') || '{}');
        document.getElementById('modalCompanyName').value = companyData.companyName || '';
        document.getElementById('modalWorkDays').value = companyData.workDays || '6';
        document.getElementById('modalWorkHours').value = companyData.workHours || '';
        document.getElementById('modalWeeklyLimit').value = companyData.weeklyLimit || '40';
        companyModal.style.display = 'flex';
      };
      document.getElementById('closeCompanyModal').onclick = function() {
        companyModal.style.display = 'none';
      };
      document.getElementById('companyForm').onsubmit = function(e) {
        e.preventDefault();
        const companyData = {
          companyName: document.getElementById('modalCompanyName').value.trim(),
          workDays: parseInt(document.getElementById('modalWorkDays').value),
          workHours: document.getElementById('modalWorkHours').value.trim(),
          weeklyLimit: parseInt(document.getElementById('modalWeeklyLimit').value)
        };
        localStorage.setItem('companyData', JSON.stringify(companyData));
        alert('Podaci tvrtke spremljeni!');
        companyModal.style.display = 'none';
      };
    }

    // Modal za zahtjev
    if (user.role === 'worker') {
      let modal = document.createElement('div');
      modal.id = 'requestModal';
      modal.style.display = 'none';
      modal.style.position = 'fixed';
      modal.style.top = '0';
      modal.style.left = '0';
      modal.style.width = '100vw';
      modal.style.height = '100vh';
      modal.style.background = 'rgba(0,0,0,0.7)';
      modal.style.justifyContent = 'center';
      modal.style.alignItems = 'center';
      modal.innerHTML = '<div style="background:#181c24;padding:36px 28px;border-radius:16px;max-width:440px;margin:100px auto;display:flex;flex-direction:column;gap:18px;box-shadow:0 6px 32px #000b;border:2px solid #232837;">'
        + '<h3>Zahtjev za radne dane</h3>'
        + '<form id="requestForm">'
        + '<label for="requestCode">Kod rasporeda:</label>'
        + '<input type="text" id="requestCode" maxlength="12" style="width:160px;text-transform:uppercase;margin-bottom:8px;">'
        + '<label>Upiši dane i vrijeme kada možeš raditi:</label>'
        + '<textarea id="requestText" rows="5" style="width:100%;resize:vertical;"></textarea>'
        + '<button type="submit">Pošalji zahtjev</button>'
        + '<button type="button" id="closeRequestModal" style="background:#444;margin-top:8px;">Odustani</button>'
        + '</form></div>';
      document.body.appendChild(modal);
      document.getElementById('openRequestModal').onclick = function() {
        modal.style.display = 'flex';
      };
      document.getElementById('closeRequestModal').onclick = function() {
        modal.style.display = 'none';
      };
      document.getElementById('requestForm').onsubmit = function(e) {
        e.preventDefault();
        const code = document.getElementById('requestCode').value.trim().toUpperCase();
        if (!code) { alert('Unesite kod rasporeda!'); return; }
        let allRequests = JSON.parse(localStorage.getItem('workerRequests') || '{}');
        if (!allRequests[code]) allRequests[code] = {};
        // Spremi zahtjev pod username#id
        const workerKey = user.username + '#' + (user.id || '');
        allRequests[code][workerKey] = document.getElementById('requestText').value.trim();
        localStorage.setItem('workerRequests', JSON.stringify(allRequests));
        alert('Zahtjev spremljen!');
        modal.style.display = 'none';
      };
    }
  });
  </script>
</body>
</html>
